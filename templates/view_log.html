<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visor de Logs - {{ file_path }}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/view_log.css') }}"
    />
  </head>
  <body>
    <div class="container-fluid px-2">
      <!-- Reducido de px-4 -->
      <!-- Header -->
      <div class="sticky-header navbar-custom">
        <div class="card-custom rounded-3">
          <div class="d-flex align-items-center mb-2">
            <!-- Reducido de mb-3 -->
            <i
              class="bi bi-file-earmark-text-fill text-info me-2"
              style="font-size: 1.5rem"
            ></i>
            <!-- Reducido de 2rem y me-3 -->
            <div>
              <h2 class="text-light mb-0">Visor de Logs</h2>
              <code class="text-info fs-6">{{ file_path }}</code>
            </div>
            <div class="ms-auto d-flex align-items-center">
              <span class="text-light small me-3"
                >¡Hola, <strong>{{ user.id }}</strong>!</span
              >
              <a
                href="{{ url_for('logout') }}"
                class="btn btn-outline-danger"
                style="
                  --bs-btn-padding-y: 0.15rem;
                  --bs-btn-padding-x: 0.5rem;
                  --bs-btn-font-size: 0.75rem;
                "
              >
                <i class="bi bi-box-arrow-right me-1"></i>Salir
              </a>
            </div>
          </div>

          <!-- Breadcrumb -->
          <nav aria-label="breadcrumb" class="mb-2">
            <!-- Reducido de mb-4 -->
            <ol class="breadcrumb mb-0">
              <li class="breadcrumb-item">
                <a
                  href="{{ url_for('browse', req_path='/'.join(file_path.split('/')[:-1]) if '/' in file_path else '') }}"
                  class="text-decoration-none d-flex align-items-center"
                >
                  <i class="bi bi-folder2-open me-1"></i>
                  <!-- Reducido de me-2 -->
                  Volver a {{ '/'.join(file_path.split('/')[:-1]) if '/' in
                  file_path else 'logs' }}/
                </a>
              </li>
              <li class="breadcrumb-item active" aria-current="page">
                {{ file_path.split('/')[-1] }}
              </li>
            </ol>
          </nav>

          <!-- Search Section -->
          <div class="filter-section">
            <form id="filterForm" class="row g-2 align-items-end">
              <!-- Reducido de g-3 -->
              <div class="col-md-6">
                <label
                  for="searchInput"
                  class="form-label text-light small mb-1"
                >
                  <!-- Añadido small y mb-1 -->
                  <i class="bi bi-search me-1"></i>Buscar en logs
                </label>
                <div class="input-group input-group-sm">
                  <!-- Añadido input-group-sm -->
                  <input
                    type="text"
                    id="searchInput"
                    class="form-control bg-dark text-light border-secondary"
                    placeholder="Ingresa términos de búsqueda..."
                    value="{{ query | e }}"
                  />
                  <button
                    type="button"
                    id="clearSearch"
                    class="btn btn-outline-danger btn-sm"
                    title="Limpiar búsqueda"
                  >
                    <i class="bi bi-x-lg"></i>
                  </button>
                  <button
                    type="submit"
                    class="btn btn-primary btn-sm"
                    title="Buscar"
                  >
                    <i class="bi bi-search"></i>
                  </button>
                </div>
              </div>

              <div class="col-auto">
                <div
                  class="btn-group btn-group-sm"
                  role="group"
                  aria-label="Navegación de coincidencias"
                >
                  <button
                    type="button"
                    id="prevBtn"
                    class="btn btn-outline-light"
                    title="Anterior"
                  >
                    <i class="bi bi-chevron-left"></i>
                  </button>
                  <button
                    type="button"
                    id="nextBtn"
                    class="btn btn-outline-light"
                    title="Siguiente"
                  >
                    <i class="bi bi-chevron-right"></i>
                  </button>
                </div>
              </div>

              <div class="col-auto">
                <span class="stats-badge" id="matchInfo">Cargando...</span>
              </div>
            </form>

            <!-- Secondary Filters -->
            <div class="row g-2 mt-2 pt-2 border-top border-secondary">
              <!-- Reducido de g-3 mt-3 pt-3 -->
              <div class="col-md-4">
                <label class="form-label text-light small mb-1">
                  <!-- Añadido small y mb-1 -->
                  <i class="bi bi-funnel me-1"></i>Nivel de Log
                </label>
                <div class="d-flex flex-wrap gap-2">
                  <!-- Reducido de gap-3 -->
                  <div class="form-check form-check-inline m-0">
                    <!-- Añadido form-check-inline y m-0 -->
                    <input
                      class="form-check-input level-check filter-control"
                      type="checkbox"
                      value="DEBUG"
                      id="levelDebug"
                    />
                    <label class="form-check-label text-light" for="levelDebug">
                      <span class="level-badge level-debug">DEBUG</span>
                    </label>
                  </div>
                  <div class="form-check form-check-inline m-0">
                    <input
                      class="form-check-input level-check filter-control"
                      type="checkbox"
                      value="INFO"
                      id="levelInfo"
                    />
                    <label class="form-check-label text-light" for="levelInfo">
                      <span class="level-badge level-info">INFO</span>
                    </label>
                  </div>
                  <div class="form-check form-check-inline m-0">
                    <input
                      class="form-check-input level-check filter-control"
                      type="checkbox"
                      value="ERROR"
                      id="levelError"
                    />
                    <label class="form-check-label text-light" for="levelError">
                      <span class="level-badge level-error">ERROR</span>
                    </label>
                  </div>
                </div>
              </div>

              <div class="col-md-3">
                <label
                  class="form-label text-light small mb-1"
                  for="dateFilter"
                >
                  <!-- Añadido small y mb-1 -->
                  <i class="bi bi-calendar3 me-1"></i>Fecha
                </label>
                <input
                  type="date"
                  class="form-control form-control-sm bg-dark text-light border-secondary filter-control"
                  id="dateFilter"
                />
              </div>

              <div class="col-md-3">
                <label class="form-label text-light small mb-1">
                  <!-- Añadido small y mb-1 -->
                  <i class="bi bi-gear me-1"></i>Opciones
                </label>
                <div class="form-check">
                  <input
                    class="form-check-input filter-control"
                    type="checkbox"
                    id="loggerGXU"
                  />
                  <label
                    class="form-check-label text-light small"
                    for="loggerGXU"
                  >
                    <!-- Añadido small -->
                    Solo GeneXusUserLog
                  </label>
                </div>
              </div>

              <div class="col-md-2 d-flex align-items-end">
                <button
                  type="button"
                  id="clearAllFilters"
                  class="btn btn-outline-warning btn-sm w-100"
                >
                  <!-- Añadido btn-sm -->
                  <i class="bi bi-arrow-clockwise me-1"></i>Limpiar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Log Container -->
      <div class="log-container mt-2 fade-in" id="logContainer">
        <!-- Reducido de mt-4 -->
        <!-- Las líneas de log se insertarán aquí por Jinja -->
        {% if highlighted_lines %} {% for backend_idx, line_content in
        highlighted_lines %}
        <div
          class="log-line-item {% if backend_idx is not none %}backend-match-initial{% endif %}"
          data-original-text="{{ line_content | e }}"
        >
          {{ line_content | e }}
        </div>
        {% endfor %} {% else %}
        <div class="empty-state">
          <i class="bi bi-file-earmark-excel"></i>
          <p>No hay líneas de log para mostrar o el archivo está vacío.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/view_log.js') }}"></script>
  </body>
</html>
